!function(){"use strict";chrome.runtime.onMessage.addListener(((e,o,t)=>{if(!chrome.runtime.lastError){if("saveMemo"===e.type){let o=(new Date).toISOString().slice(0,10);return console.log("saveMemo",o),chrome.storage.local.set({[o]:e.text},(()=>{chrome.storage.local.get("memoPosition",(o=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{for(let r of t)chrome.tabs.sendMessage(r.id,{type:"memoSaved",text:e.text,position:o.memoPosition},(function(e){chrome.runtime.lastError?console.warn("No receiving end:",chrome.runtime.lastError.message):console.log("Response from content:",e)}))}))})),t({status:"ok"})})),!0}if("updateTotalMemo"===e.type)return chrome.storage.local.set({totalMemoInfo:e.info},(()=>{t({status:"ok"})})),!0;if("getTotalMemoInfo"===e.type)return chrome.storage.local.get("totalMemoInfo",(e=>{t({info:e})})),!0;if("getTodayMemo"===e.type){let e=(new Date).toISOString().slice(0,10);return console.log("getTodayMemo",e),chrome.storage.local.get([e],(e=>{t({text:e})})),!0}if("openBrowserMemoModal"===e.type){let o=(new Date).toISOString().slice(0,10);return chrome.storage.local.get([o],(r=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{for(let s of t)chrome.tabs.sendMessage(s.id,{type:"positionChanged",text:r[o],position:e.position},(function(e){chrome.runtime.lastError?console.warn("No receiving end:",chrome.runtime.lastError.message):console.log("Response from content:",e)}))})),t({isOpen:!0})})),!0}return"saveMemoPosition"===e.type?(chrome.storage.local.set({memoPosition:e.position},(()=>{t({status:"ok"})})),!0):"getMemoPosition"===e.type?(chrome.storage.local.get("memoPosition",(e=>{t({position:e})})),!0):"reSettingChromeLocalStorage"===e.type?(chrome.storage.local.get(null,(e=>{let o=(new Date).toISOString().slice(0,10);console.log("reSettingChromeLocalStorage",o);const r=Object.keys(e).filter((e=>o!==e&&e.includes("-")));r.length<1&&t({status:"ok"}),chrome.storage.local.remove(r,(()=>{t({status:"ok"})}))})),!0):void 0}console.warn("No receiving end:",chrome.runtime.lastError.message)}))}();
